{% extends 'base.html' %}
{% block content %}

<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css');

    :root {
        --primary-color: #4f46e5;
        --primary-light: #6366f1;
        --secondary-color: #10b981;
        --accent-color: #f59e0b;
        --dark-color: #1e293b;
        --light-color: #f8fafc;
        --danger-color: #ef4444;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    }

    .container {
        max-width: 1400px;
        margin-top: 2rem;
        animation: fadeIn 0.8s ease-out;
    }

    h2 {
        font-weight: 600;
        color: var(--dark-color);
        margin-bottom: 1.5rem;
        position: relative;
        padding-bottom: 0.5rem;
    }

    h2:after {
        content: '';
        position: absolute;
        left: 0;
        bottom: 0;
        width: 80px;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        border-radius: 2px;
    }

    .search-container {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(79, 70, 229, 0.1);
        margin-bottom: 2rem;
    }

    .search-input {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        font-size: 1rem;
        transition: all 0.3s ease;
    }

    .search-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
    }

    .search-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        color: white;
        transition: all 0.3s ease;
    }

    .search-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(79, 70, 229, 0.2);
    }

    .refresh-btn {
        background: linear-gradient(135deg, var(--secondary-color), #34d399));
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        color: white;
        transition: all 0.3s ease;
    }

    .refresh-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(16, 185, 129, 0.2);
    }

    .alert-danger {
        background: linear-gradient(135deg, var(--danger-color), #dc2626));
        color: white;
        border: none;
        border-radius: 10px;
        padding: 1rem;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
    }

    .report-table {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
    }

    .report-table thead {
        background: linear-gradient(135deg, var(--dark-color), #334155));
        color: white;
    }

    .report-table th {
        font-weight: 500;
        padding: 1rem;
        text-align: left;
    }

    .report-table td {
        padding: 0.75rem 1rem;
        vertical-align: middle;
        border-bottom: 1px solid #e2e8f0;
    }

    .report-table tr:last-child td {
        border-bottom: none;
    }

    .report-table tr:hover {
        background-color: #f8fafc;
    }

    .report-image {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 8px;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .report-image:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .dummy-image {
        filter: grayscale(100%);
        opacity: 0.7;
    }

    .status-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 50px;
        font-weight: 500;
        font-size: 0.85rem;
    }

    .status-passed {
        background-color: #dcfce7;
        color: #166534;
    }

    .status-failed {
        background-color: #fee2e2;
        color: #991b1b;
    }

    .download-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        color: white;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(79, 70, 229, 0.1);
    }

    .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(79, 70, 229, 0.2);
    }

    .back-btn {
        background: linear-gradient(135deg, #64748b, #475569);
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        color: white;
        transition: all 0.3s ease;
    }

    .back-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(100, 116, 139, 0.2);
    }

    .pagination .page-item.active .page-link {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        border: none;
        color: white;
    }

    .pagination .page-link {
        border: none;
        color: var(--primary-color);
        margin: 0 5px;
        border-radius: 8px !important;
        transition: all 0.3s ease;
    }

    .pagination .page-link:hover {
        background-color: #e0e7ff;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.03); }
        100% { transform: scale(1); }
    }

    .checkbox-cell {
        position: relative;
    }

    .checkbox-cell input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    /* Responsive adjustments */
    @media (max-width: 992px) {
        .report-table {
            display: block;
            overflow-x: auto;
        }

        .report-image {
            width: 80px;
            height: 80px;
        }
    }
</style>

<div class="container">
    <h2>ðŸ“„ Select Records for PDF Report ({{ current_year }})</h2>

    <!-- Error Message -->
    {% if error_message %}
    <div class="alert alert-danger mb-4">
        <i class="fas fa-exclamation-circle me-2"></i>{{ error_message }}
    </div>
    {% endif %}

    <!-- Search Bar -->
    <form action="{% url 'download_selected_pdf' %}" method="GET" class="search-container">
        <div class="row g-2">
            <div class="col-md-6">
                <input class="form-control search-input" name="search"
                       placeholder="Search by Title or Facility..." type="text"
                       value="{{ search_query }}">
            </div>
            <div class="col-md-2">
                <button class="btn search-btn w-100" type="submit">
                    <i class="fas fa-search me-2"></i>Search
                </button>
            </div>
            <div class="col-md-2">
                <a href="{% url 'download_selected_pdf'%}" class="btn refresh-btn w-100">
                    <i class="fas fa-sync-alt me-2"></i>Refresh
                </a>
            </div>
        </div>
    </form>

    <!-- Form to select and download -->
    <form action="{% url 'download_selected_pdf' %}" method="GET">
        <div class="report-table">
            <table class="table table-hover mb-0">
                <thead>
                <tr>
                    <th>Select</th>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Facility</th>
                    <th>Status</th>
                    <th>Created Date</th>
                    <th>Uploaded By</th>
                    <th>Standard Image</th>
                    <th>Latest Image</th>
                </tr>
                </thead>
                <tbody>
                {% for img in page_obj %}
                {% if img.status != "Pending" %}
                <tr>
                    <td class="checkbox-cell">
                        <input name="selected_ids" type="checkbox" value="{{ img.id }}" class="form-check-input">
                    </td>
                    <td><strong>#{{ img.id }}</strong></td>
                    <td>{{ img.title }}</td>
                    <td>{{ img.s_image.facility.name }}</td>
                    <td>
                        <span class="status-badge {% if img.status == 'Passed' %}status-passed{% else %}status-failed{% endif %}">
                            {{ img.status }}
                        </span>
                    </td>
                    <td>{{ img.created|date:"Y-m-d H:i" }}</td>
                    <td>{{ img.uploaded_by }}</td>
                    <td>
                        {% if img.recent_image %}
                        <img src="{{ img.s_image.standard_image.url }}" class="report-image" alt="Standard Image">
                        {% else %}
                        <img src="/static/dummy_recent.jpg" class="report-image dummy-image" alt="No Image">
                        {% endif %}
                    </td>
                    <td>
                        {% if img.recent_image %}
                        <img src="{{ img.recent_image.url }}" class="report-image" alt="Recent Image">
                        {% else %}
                        <img src="/static/dummy_recent.jpg" class="report-image dummy-image" alt="No Image">
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Pagination Controls -->
        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?search={{ search_query }}&page=1">
                        <i class="fas fa-angle-double-left"></i> First
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?search={{ search_query }}&page={{ page_obj.previous_page_number }}">
                        <i class="fas fa-angle-left"></i> Previous
                    </a>
                </li>
                {% endif %}

                <li class="page-item disabled">
                    <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                </li>

                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?search={{ search_query }}&page={{ page_obj.next_page_number }}">
                        Next <i class="fas fa-angle-right"></i>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link" href="?search={{ search_query }}&page={{ page_obj.paginator.num_pages }}">
                        Last <i class="fas fa-angle-double-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>

        <!-- Download Button -->
        {% if page_obj %}
        <div class="text-center mt-4">
            <button class="btn download-btn" type="submit">
                <i class="fas fa-file-pdf me-2"></i>Download Selected PDF
            </button>
            <a class="btn back-btn ms-3" href="{% url 'assessment' %}">
                <i class="fas fa-arrow-left me-2"></i>Back to Assessment
            </a>
        </div>
        {% endif %}
    </form>
</div>

<script>
    // Add animation to table rows
    document.addEventListener('DOMContentLoaded', function() {
        const rows = document.querySelectorAll('tbody tr');

        rows.forEach((row, index) => {
            row.style.opacity = '0';
            row.style.transform = 'translateX(-20px)';
            row.style.transition = `all 0.5s ease-out ${index * 0.05}s`;

            setTimeout(() => {
                row.style.opacity = '1';
                row.style.transform = 'translateX(0)';
            }, 100);
        });

        // Add pulse animation to download button
        const downloadBtn = document.querySelector('.download-btn');
        if (downloadBtn) {
            setInterval(() => {
                downloadBtn.classList.add('pulse-animation');
                setTimeout(() => {
                    downloadBtn.classList.remove('pulse-animation');
                }, 1000);
            }, 3000);
        }
    });
</script>

{% endblock %}