{% extends 'base.html' %}
{% block content %}
<style>
  :root {
    --bg-light: linear-gradient(to right, #f0f9ff, #e0f7fa);
    --text-light: #333;
    --bg-dark: #1e1e1e;
    --text-dark: #e0e0e0;
    --card-shadow: rgba(0, 0, 0, 0.1);
  }

  [data-theme="dark"] {
    --bg-light: #1e1e1e;
    --text-light: #e0e0e0;
    --card-shadow: rgba(255, 255, 255, 0.05);
  }

  body {
    background: var(--bg-light);
    color: var(--text-light);
    transition: background 0.5s, color 0.5s;
  }

  #greeting-card {
    max-width: 600px;
    margin: 2rem auto;
    border-radius: 1.5rem;
    padding: 2rem;
    font-family: 'Segoe UI', sans-serif;
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s ease;
    box-shadow: 0 10px 20px var(--card-shadow);
    background: var(--bg-light);
    color: var(--text-light);
    position: relative;
  }

  .slide-left { transform: translateX(-50px); }
  .slide-up { transform: translateY(30px); }
  .zoom-in { transform: scale(0.8); }
  .show {
    opacity: 1 !important;
    transform: translateX(0) translateY(0) scale(1) !important;
  }

  #greeting {
    font-size: 1.25rem;
    line-height: 1.6;
    min-height: 100px;
  }

  small {
    display: block;
    margin-top: 1rem;
    opacity: 0.6;
  }


  #lang-toggle {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background: transparent;
    border: none;
    font-size: 0.9rem;
    cursor: pointer;
    color: inherit;
    padding: 0.3rem 0.6rem;
    border-radius: 8px;
    transition: background 0.3s;
  }

  #lang-toggle:hover {
    background: rgba(255, 255, 255, 0.1);
  }
</style>

<div id="greeting-card">

  <button id="lang-toggle">🌐 EN</button><br/>
  <h2 style="margin-bottom: 1rem;">👋 Welcome Back!</h2>
  <div id="greeting"></div>
</div>

<audio id="type-sound" preload="auto">
  <source src="data:audio/mp3;base64,//uQx...etc" type="audio/mp3">
</audio>

<script>
  const user = "{{ user_name|escapejs }}";
  const greetingElement = document.getElementById("greeting");
  const typeSound = document.getElementById("type-sound");
  const langToggle = document.getElementById("lang-toggle");
  const card = document.getElementById("greeting-card");

  // Language setting
  let currentLang = localStorage.getItem("lang") || "en";
  updateLangToggle();

  langToggle.addEventListener("click", () => {
    currentLang = currentLang === "en" ? "ceb" : currentLang === "ceb" ? "tl" : "en";
    localStorage.setItem("lang", currentLang);
    updateLangToggle();
    renderGreeting();
  });

  function updateLangToggle() {
    const display = { en: "🌐 EN", ceb: "🌐 CEB", tl: "🌐 TL" };
    langToggle.textContent = display[currentLang];
  }

  function renderGreeting() {
    const now = new Date();
    const phTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Manila" }));
    const hour = phTime.getHours();

    const dateString = phTime.toLocaleDateString('en-PH', {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });
    const timeString = phTime.toLocaleTimeString('en-PH', {
      hour: '2-digit', minute: '2-digit', hour12: true
    });

    const greetings = {
      en: {
        morning: `🌞 Good morning, ${user}!<br>Rise and shine — may your day be filled with light, purpose, and little victories. ✨`,
        afternoon: `☀️ Good afternoon, ${user}!<br>The sun is high and so is your potential. Keep going strong — the day is yours! 💪`,
        evening: `🌆 Good evening, ${user}!<br>May this evening bring you peace and reflection after a day well spent. 🌙`,
        night: `🌌 Good night, ${user}!<br>The stars are out, and so are dreams waiting to be chased tomorrow. 🌟`
      },
      ceb: {
        morning: `🌞 Maayong buntag, ${user}!<br>Pagmata na, ug hinaut nga puno sa kalipay ug kalampusan ang imong adlaw. ✨`,
        afternoon: `☀️ Maayong hapon, ${user}!<br>Padayon lang sa paningkamot — imo gyud ni nga adlaw! 💪`,
        evening: `🌆 Maayong gabii, ${user}!<br>Hinaut nga hatagan ka'g kalinaw ug pagpamalandong karong gabhiona. 🌙`,
        night: `🌌 Maayong gabii na, ${user}!<br>Ang mga bituon mipakita na — andama na ang imong mga damgo. 🌟`
      },
      tl: {
        morning: `🌞 Magandang umaga, ${user}!<br>Gising na! Nawa'y maging makabuluhan ang iyong araw. ✨`,
        afternoon: `☀️ Magandang hapon, ${user}!<br>Tuloy lang sa pag-abot ng iyong mga pangarap — sa'yo ang araw na ito! 💪`,
        evening: `🌆 Magandang gabi, ${user}!<br>Nawa'y maging payapa at makahulugan ang iyong gabi. 🌙`,
        night: `🌌 Gabi na, ${user}!<br>Nagniningning na ang mga bituin — panahon na para mangarap. 🌟`
      }
    };

    let timeKey = "";
    if (hour >= 5 && hour < 12) {
      timeKey = "morning";
      card.className = "slide-left show";
    } else if (hour >= 12 && hour < 17) {
      timeKey = "afternoon";
      card.className = "zoom-in show";
    } else if (hour >= 17 && hour < 21) {
      timeKey = "evening";
      card.className = "slide-up show";
    } else {
      timeKey = "night";
      card.className = "zoom-in show";
    }

    const greetingText = greetings[currentLang][timeKey];
    const timeInfo = `<small id="time-info">${dateString} | ${timeString} | Philippines 🇵🇭</small>`;
    const fullGreeting = `${greetingText}<br><br>${timeInfo}`;


    const tempDiv = document.createElement("div");
    tempDiv.innerHTML = fullGreeting;
    const rawText = tempDiv.textContent || tempDiv.innerText || "";

    greetingElement.innerHTML = "";
    typeWriter(rawText, () => {
      greetingElement.innerHTML = fullGreeting;
    });
  }

  function typeWriter(text, callback, i = 0) {
    if (i < text.length) {
      greetingElement.innerHTML += text.charAt(i);
      try {
        typeSound.currentTime = 0;
        typeSound.play();
      } catch (e) {}
      setTimeout(() => typeWriter(text, callback, i + 1), 25);
    } else {
      callback?.();
    }
  }

function updateTimeOnly() {
  const now = new Date();
  const phTime = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Manila" }));

  const dateString = phTime.toLocaleDateString('en-PH', {
    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
  });
  const timeString = phTime.toLocaleTimeString('en-PH', {
    hour: '2-digit', minute: '2-digit', hour12: true
  });

  const timeInfo = `${dateString} | ${timeString} | Philippines 🇵🇭`;
  const timeSpan = document.getElementById("time-info");
  if (timeSpan) timeSpan.textContent = timeInfo;
}

// Refresh time every minute
setInterval(updateTimeOnly,1000);


  window.addEventListener("load", () => {
  renderGreeting();
  updateTimeOnly(); // Initial update
});
</script>


{% endblock %}